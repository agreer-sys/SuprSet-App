export type Pattern = 'superset'|'straight_sets'|'circuit'|'custom';
export type Mode = 'time'|'reps';
export type ChatterLevel = 'silent'|'signals'|'minimal'|'standard'|'high';

export interface BlockParams {
  pattern: Pattern;
  mode: Mode;
  awaitReadyBeforeStart?: boolean; // default false
  partnerAlt?: boolean;
  restBetweenPartnersSec?: number;  // default 0
  speakCountdownSec?: number;       // default 3
  safety?: { maxRPE?: number; allowPainProceed?: boolean };
  chatterLevel?: ChatterLevel;      // default 'minimal'
}

export interface WorkoutPrefs {
  preflightLoadIntake: boolean;     // default true
  strictEMOM: boolean;              // default true
  allowAutoExtendRest: false;       // per decision
  rpeLabels: 'words'|'numbers'|'both'; // default 'words'
}

export type Event =
  | { type:'EV_BLOCK_START'; blockId:string }
  | { type:'EV_AWAIT_READY'; blockId:string }
  | { type:'EV_COUNTDOWN'; sec:number }
  | { type:'EV_WORK_PREVIEW'; exerciseId:string; setIndex?: number; totalSets?: number; roundIndex?: number; totalRounds?: number } // NEW
  | { type:'EV_WORK_START'; exerciseId:string; setIndex?: number; totalSets?: number }
  | { type:'EV_WORK_END'; exerciseId:string }
  | { type:'EV_REST_START'; sec:number; reason?:string }
  | { type:'EV_REST_END' }
  | { type:'EV_ROUND_REST_START'; sec:number }
  | { type:'EV_ROUND_REST_END' }
  | { type:'EV_BLOCK_END'; blockId:string }
  | { type:'EV_WORKOUT_END' };

// Optional meta access (if you expose cues/equipment/etc.)
export interface ExerciseMeta {
  id: string|number;
  name: string;
  cues?: string[];
  equipment?: string[];
  muscleGroup?: string;
  estimatedTimeSec?: number;
}

export interface TimelineContext {
  workoutId: string;
  blockId?: string;
  pattern: Pattern;
  mode: Mode;
  chatterLevel: ChatterLevel;
  prefs: WorkoutPrefs;
  nowMs(): number;

  // data hooks
  getExerciseName(id:string): string;
  getNextExerciseName?(id?:string): string | undefined;

  // OPTIONAL: if present, weâ€™ll use cues for {{cue}}/{{tempoCue}}
  getExerciseMeta?(id:string): ExerciseMeta;

  plannedLoads: Record<string, number | undefined>; // per exerciseId (kg)

  // ui/system hooks
  showReadyModal?: () => Promise<void>;
  openRestQuickLog?: (exerciseId:string) => void;
  speak?: (text:string) => void;

  // Beep kinds used app-side: 'start' (GO), 'last5', 'end' (work end), 'countdown'
  beep?: (kind:'start'|'last5'|'end'|'countdown') => void;

  caption?: (text:string) => void;
  haptic?: (kind:'light'|'medium'|'heavy') => void;
}
